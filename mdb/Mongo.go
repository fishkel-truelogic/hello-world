package mdb

//////////////////////////////////////////////////////////////////////////////
// Imports
//////////////////////////////////////////////////////////////////////////////

import (
	"fmt"
	"gopkg.in/mgo.v2"
    "os"
)

//////////////////////////////////////////////////////////////////////////////
// Fields
//////////////////////////////////////////////////////////////////////////////
var sess *mgo.Session

func GetSession() *mgo.Session {
	if sess == nil {
		sess = ConnectToMongoDB()
	}
	return sess
}
//////////////////////////////////////////////////////////////////////////////
// Functions
//////////////////////////////////////////////////////////////////////////////
func ConnectToMongoDB() *mgo.Session {
	uri := os.Getenv("MONGOHQ_URL")

	if uri == "" {
		fmt.Println("no connection string provided")
		os.Exit(1)
	}

	sessi, err := mgo.Dial(uri)

	if err != nil {
		fmt.Printf("Can't connect to mongo, go error %v\n", err)
		os.Exit(1)
	}

	sessi.SetSafe(&mgo.Safe{})

	return sessi
}